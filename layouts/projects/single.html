{{ define "main" }}

<article style="max-width: 1000px; margin: 0 auto; padding: 4rem 3rem;">
  
  {{/* Project Header */}}
  <header style="margin-bottom: 4rem;">
    <h1 style="font-size: 3rem; font-weight: 300; margin-bottom: 1rem; font-style: italic;">
      {{ .Title }}
    </h1>
  </header>

  {{/* Project Content */}}
  <div style="max-width: 42rem; font-size: 1.0625rem; line-height: 1.8; margin-bottom: 4rem;">
    {{ .Content }}
  </div>

  {{/* Updates Section */}}
  {{ if .Params.series }}
    {{ $seriesName := strings.ToLower (index .Params.series 0) }}
    {{ $allPosts := sort (index .Site.Taxonomies.series $seriesName) "Date" "desc" }}
    {{ $blogPosts := where $allPosts "Section" "blog" }}
    
    {{ $latestPost := index $blogPosts 0 }}
    {{ $olderPosts := after 1 $blogPosts }}
    
    {{/* Latest Update */}}
    {{ if $latestPost }}
      <div style="margin-top: 4rem; margin-bottom: 4rem;">
        <h2 style="font-size: 2rem; font-weight: 300; margin-bottom: 2rem; font-style: italic;">
          Latest Update
        </h2>
        <div style="margin-bottom: 2rem;">
          <div style="font-size: 0.875rem; color: #999; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em;">
            {{ $latestPost.Date.Format "January 2, 2006" }}
          </div>
          <div style="font-size: 1.0625rem; line-height: 1.8;">
            {{ $latestPost.Content }}
          </div>
        </div>
      </div>
    {{ end }}
    
    {{/* Past Updates */}}
    {{ if $olderPosts }}
      <div style="margin-top: 4rem; margin-bottom: 4rem;">
        <h2 style="font-size: 2rem; font-weight: 300; margin-bottom: 2rem; font-style: italic;">
          Past Updates
        </h2>
        <div style="display: flex; flex-direction: column; gap: 1.5rem;">
          {{ range $olderPosts }}
            <div>
              <a href="{{ .RelPermalink }}" style="color: #fff; text-decoration: none; font-size: 1.25rem; display: block; margin-bottom: 0.25rem;">
                {{ .Title }}
              </a>
              <div style="font-size: 0.875rem; color: #999; text-transform: uppercase; letter-spacing: 0.05em;">
                {{ .Date.Format "January 2, 2006" }}
              </div>
            </div>
          {{ end }}
        </div>
      </div>
    {{ end }}
  {{ end }}

  {{/* Comments Section */}}
  {{ if site.Params.article.showComments | default false }}
    <div style="margin-top: 4rem; padding-top: 3rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
      <h2 style="font-size: 1.75rem; font-weight: 300; margin-bottom: 2rem; font-style: italic;">Comments</h2>
      <div id="cusdis_thread"
        data-host="{{ site.Params.comments.cusdis.host }}"
        data-app-id="{{ site.Params.comments.cusdis.appId }}"
        data-page-id="{{ .Permalink }}"
        data-page-url="{{ .Permalink }}"
        data-page-title="{{ .Title }}"
        data-theme="dark">
      </div>
      <script async defer src="https://cusdis.com/js/cusdis.es.js"></script>
      <script>
        // Make Cusdis dark
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            mutation.addedNodes.forEach((node) => {
              if (node.tagName === 'IFRAME') {
                node.style.colorScheme = 'dark';
                try {
                  const iframeDoc = node.contentDocument || node.contentWindow.document;
                  const style = iframeDoc.createElement('style');
                  style.textContent = `
                    body { background: #000 !important; color: #fff !important; }
                    * { color: #fff !important; background: transparent !important; }
                    input, textarea { background: #1a1a1a !important; border: 1px solid #333 !important; color: #fff !important; }
                    button { background: #ff8c42 !important; color: #fff !important; }
                  `;
                  iframeDoc.head.appendChild(style);
                } catch (e) {}
              }
            });
          });
        });
        observer.observe(document.getElementById('cusdis_thread'), { childList: true, subtree: true });
      </script>
    </div>
  {{ end }}

</article>

{{ end }}
