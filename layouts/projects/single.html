{{ define "main" }}

<div style="background-color: #faf8f5 !important; min-height: 100vh;">
<article style="max-width: 1000px; margin: 0 auto; padding: 4rem 3rem; background-color: #faf8f5 !important; background: #faf8f5 !important;">
  
  {{/* Project Header */}}
  <header style="margin-bottom: 4rem; border: none !important; background-color: #faf8f5 !important; background: #faf8f5 !important; text-align: left;">
    <h1 style="font-family: Georgia, serif; font-size: 3rem; font-weight: 300; color: #2d2d2d; margin-bottom: 1rem; font-style: italic; border: none !important; background-color: #faf8f5 !important; background: #faf8f5 !important; text-align: left;">
      {{ .Title }}
    </h1>
  </header>

  {{/* Project Content (Concept, Challenge, Materials) */}}
  <div style="max-width: 42rem; font-family: Georgia, serif; font-size: 1.0625rem; line-height: 1.8; color: #5a5a5a; background-color: #faf8f5 !important; background: #faf8f5 !important; margin-bottom: 4rem;">
    {{ .Content }}
  </div>

  {{/* Updates Section */}}
  {{ if .Params.series }}
    {{ $seriesName := strings.ToLower (index .Params.series 0) }}
    {{ $allPosts := sort (index .Site.Taxonomies.series $seriesName) "Date" "desc" }}
    {{ $blogPosts := where $allPosts "Section" "blog" }}
    
    {{ $latestPost := index $blogPosts 0 }}
    {{ $olderPosts := after 1 $blogPosts }}
    
    {{/* Latest Update */}}
    {{ if $latestPost }}
      <div style="margin-top: 4rem; margin-bottom: 4rem; background-color: #faf8f5 !important;">
        <h2 style="font-family: Georgia, serif; font-size: 2rem; font-weight: 300; color: #2d2d2d; margin-bottom: 2rem; font-style: italic; border: none !important; background-color: #faf8f5 !important;">
          Latest Update
        </h2>
        <div style="max-width: 42rem; background-color: #faf8f5 !important;">
          <time datetime="{{ $latestPost.Date.Format "2006-01-02" }}" style="display: block; color: #999999; font-size: 0.875rem; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em; background-color: #faf8f5 !important;">
            {{ $latestPost.Date.Format "January 2, 2006" }}
          </time>
          <div style="font-family: Georgia, serif; font-size: 1.0625rem; line-height: 1.8; color: #5a5a5a; background-color: #faf8f5 !important;">
            {{ $latestPost.Content }}
          </div>
        </div>
      </div>
    {{ end }}
    
    {{/* Past Updates */}}
    {{ if $olderPosts }}
      <div style="margin-top: 4rem; background-color: #faf8f5 !important;">
        <h2 style="font-family: Georgia, serif; font-size: 2rem; font-weight: 300; color: #2d2d2d; margin-bottom: 2rem; font-style: italic; border: none !important; background-color: #faf8f5 !important;">
          Past Updates
        </h2>
        <div style="max-width: 42rem; background-color: #faf8f5 !important;">
          {{ range $olderPosts }}
            <div style="background-color: #faf8f5 !important; margin-bottom: 1.5rem;">
              <time datetime="{{ .Date.Format "2006-01-02" }}" style="display: block; color: #999999; font-size: 0.875rem; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">
                {{ .Date.Format "January 2, 2006" }}
              </time>
              <a href="{{ .RelPermalink }}" style="font-family: Georgia, serif; font-size: 1.25rem; font-weight: 400; color: #2d2d2d; text-decoration: none; display: block;">
                {{ .Title }}
              </a>
            </div>
          {{ end }}
        </div>
      </div>
    {{ end }}
  {{ end }}

  {{/* Comments Section */}}
  {{ if .Params.showComments | default (site.Params.article.showComments | default false) }}
    <div style="margin-top: 4rem; max-width: 800px; background-color: #faf8f5 !important; border-top: 1px solid rgba(232, 228, 223, 0.5); padding-top: 3rem;">
      <h2 style="font-family: Georgia, serif; font-size: 1.75rem; font-weight: 300; color: #2d2d2d; margin-bottom: 2rem; font-style: italic;">Comments</h2>
      <div id="cusdis_thread"
        data-host="{{ site.Params.comments.cusdis.host }}"
        data-app-id="{{ site.Params.comments.cusdis.appId }}"
        data-page-id="{{ .RelPermalink }}"
        data-page-url="{{ .Permalink }}"
        data-page-title="{{ .Title }}"
        data-theme="light">
      </div>
      <script async defer src="https://cusdis.com/js/cusdis.es.js"></script>
      <script>
        // Inject custom CSS into Cusdis iframe
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (mutation.addedNodes.length == 0) return;
            const iframe = mutation.addedNodes[0];
            if (iframe.tagName !== 'IFRAME') return;

            const customStyles = `
              body {
                font-family: Georgia, serif !important;
                background-color: #faf8f5 !important;
              }
              
              * {
                font-family: Georgia, serif !important;
              }
              
              input, textarea {
                font-family: Georgia, serif !important;
                background-color: #ffffff !important;
                border: 1px solid #e8e4df !important;
                border-radius: 4px !important;
                padding: 0.75rem 1rem !important;
                font-size: 0.95rem !important;
                color: #2d2d2d !important;
                line-height: 1.6 !important;
              }
              
              input:focus, textarea:focus {
                outline: none !important;
                border-color: #c7653b !important;
              }
              
              textarea {
                min-height: 120px !important;
                width: 100% !important;
              }
              
              button {
                background-color: #c7653b !important;
                color: #ffffff !important;
                border: none !important;
                border-radius: 4px !important;
                padding: 0.75rem 2rem !important;
                font-size: 0.95rem !important;
                cursor: pointer !important;
                transition: background-color 0.2s ease !important;
              }
              
              button:hover {
                background-color: #a8503f !important;
              }
              
              label {
                font-size: 0.875rem !important;
                color: #5a5a5a !important;
                font-weight: 400 !important;
                margin-bottom: 0.5rem !important;
                display: block !important;
              }
              
              .cusdis-comment, [class*="comment"] {
                background-color: rgba(255, 255, 255, 0.5) !important;
                border: 1px solid #e8e4df !important;
                border-radius: 6px !important;
                padding: 1.5rem !important;
                margin-bottom: 1rem !important;
              }
              
              .cusdis-comment-nickname, [class*="nickname"] {
                font-weight: 500 !important;
                color: #2d2d2d !important;
                font-size: 1rem !important;
              }
              
              .cusdis-comment-content, [class*="content"] {
                color: #5a5a5a !important;
                line-height: 1.7 !important;
                margin-top: 0.75rem !important;
              }
              
              .cusdis-comment-date, [class*="date"] {
                font-size: 0.875rem !important;
                color: #999999 !important;
              }
            `;
            
            iframe.srcdoc = iframe.srcdoc.replace('</style>', customStyles + '</style>');
          });
        });
        observer.observe(document.getElementById("cusdis_thread"), { childList: true, subtree: true });
      </script>
    </div>
  {{ end }}

</article>
</div>

<style>
  /* Kill white backgrounds */
  article {
    background-color: transparent !important;
    background: none !important;
  }
  
  /* Kill all borders on headers */
  article header,
  article h1,
  article h2 {
    border: none !important;
    border-bottom: none !important;
  }
  
  /* Style content headings */
  article h2 {
    font-family: Georgia, serif;
    font-size: 1.75rem;
    font-weight: 400;
    color: #2d2d2d;
    margin-top: 3rem;
    margin-bottom: 1rem;
  }
  
  article h3 {
    font-family: Georgia, serif;
    font-size: 1.35rem;
    font-weight: 400;
    color: #2d2d2d;
    margin-top: 2.5rem;
    margin-bottom: 0.75rem;
  }
  
  article p {
    margin-bottom: 1.5rem;
  }
  
  article strong {
    color: #2d2d2d;
    font-weight: 500;
  }
  
  article a {
    color: #c7653b;
    text-decoration: none;
  }
  
  article a:hover {
    text-decoration: underline;
  }
  
  article ul, article ol {
    margin: 1.5rem 0;
    padding-left: 2rem;
  }
  
  article li {
    margin-bottom: 0.75rem;
  }
</style>

{{ end }}
