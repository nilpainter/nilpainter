{{ define "main" }}

<article style="max-width: 800px; margin: 0 auto; padding: 4rem 3rem;">
  
  {{/* Project link if part of a series */}}
  {{ if .Params.series }}
    {{ $seriesName := strings.ToLower (index .Params.series 0) }}
    {{ $projectPage := site.GetPage (printf "/projects/%s" (urlize $seriesName)) }}
    {{ if $projectPage }}
      <div style="background: rgba(255, 140, 66, 0.15); border-left: 3px solid #ff8c42; padding: 1.25rem 1.5rem; margin-bottom: 3rem; border-radius: 4px;">
        <p style="font-size: 0.95rem; margin: 0;">
          This post is part of the project: 
          <a href="{{ $projectPage.RelPermalink }}" style="color: #ff8c42; text-decoration: none; font-weight: 500;">
            {{ $projectPage.Title }}
          </a>
        </p>
      </div>
    {{ end }}
  {{ end }}

  {{/* Post Header */}}
  <header style="margin-bottom: 3rem;">
    <time datetime="{{ .Date.Format "2006-01-02" }}" style="display: block; color: #999999; font-size: 0.875rem; margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em;">
      {{ .Date.Format "January 2, 2006" }}
    </time>
    
    <h1 style="font-size: 2.5rem; font-weight: 300; margin-bottom: 0; line-height: 1.2;">
      {{ .Title }}
    </h1>
  </header>

  {{/* Post Content */}}
  <div style="font-size: 1.0625rem; line-height: 1.8;">
    {{ .Content }}
  </div>

  {{/* Comments Section */}}
  {{ if .Params.showComments | default (site.Params.article.showComments | default false) }}
    <div style="margin-top: 4rem; padding-top: 3rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
      <h2 style="font-size: 1.75rem; font-weight: 300; margin-bottom: 2rem; font-style: italic;">Comments</h2>
      <div id="cusdis_thread"
        data-host="{{ site.Params.comments.cusdis.host }}"
        data-app-id="{{ site.Params.comments.cusdis.appId }}"
        data-page-id="{{ .RelPermalink }}"
        data-page-url="{{ .Permalink }}"
        data-page-title="{{ .Title }}"
        data-theme="dark">
      </div>
      <script async defer src="https://cusdis.com/js/cusdis.es.js"></script>
      <script>
        // Make Cusdis dark
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            mutation.addedNodes.forEach((node) => {
              if (node.tagName === 'IFRAME') {
                node.style.colorScheme = 'dark';
                try {
                  const iframeDoc = node.contentDocument || node.contentWindow.document;
                  const style = iframeDoc.createElement('style');
                  style.textContent = `
                    body { background: #000 !important; color: #fff !important; }
                    * { color: #fff !important; background: transparent !important; }
                    input, textarea { background: #1a1a1a !important; border: 1px solid #333 !important; color: #fff !important; }
                    button { background: #ff8c42 !important; color: #fff !important; }
                  `;
                  iframeDoc.head.appendChild(style);
                } catch (e) {}
              }
            });
          });
        });
        observer.observe(document.getElementById('cusdis_thread'), { childList: true, subtree: true });
      </script>
    </div>
  {{ end }}

</article>

{{ end }}
